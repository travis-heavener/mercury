name: Build

on:
    workflow_dispatch:
    push:
        branches: ["main"]
        paths:
            - "src/**"
            - "lib/**"
    pull_request:
        branches: ["main"]
        paths:
            - "src/**"
            - "lib/**"

jobs:
    Build:
        runs-on: ubuntu-22.04
        steps:
            - uses: actions/checkout@v4

            - name: Cache APT packages
              uses: actions/cache@v4
              with:
                path: |
                    /var/cache/apt/archives
                    /var/lib/apt/lists
                key: ${{ runner.os }}-apt-${{ hashFiles('**/build_tools/install_deps.sh') }}

            # Make executables
            - name: Make Executable Shell Ccripts
              run: sudo chmod +x ./build_tools/*.sh

            # Install deps & build static binaries
            - name: Install Deps & Build Libs
              run: make libs

            # Build
            - name: Build Mercury Binaries
              run: sudo make -B